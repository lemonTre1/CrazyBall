using System.Collections;
using System.Collections.Generic;
using UnityEngine;
using UnityEngine.Networking;


public enum MapType
{
    Grass,
    Rock,
    Ice,
    Mire
}

public class MapManager : NetworkBehaviour  {
    public int Length = 100;
    public int Width = 100;

    public int SpecialFloor = 15;

    public GameObject GrassCubePrefab;
    public GameObject RockCubePrefab;
    public GameObject IceCubePrefab;
    public GameObject MireCubePrefab;

    private GameObject FloorPrefab;
    public Transform FloorParent;

    public static MapManager instance;
    private void Awake()
    {
        instance = this;
    }

    void Start () {

        //CmdTest();

    }

    void Update()
    {
        //if (Input.GetKeyDown(KeyCode.Alpha1))
        //{
        //    CmdCreatMap(MapType.Grass);
        //}

        //if (Input.GetKeyDown(KeyCode.Alpha2))
        //{
        //    CmdCreatMap(MapType.Rock);
        //}
    }
      
     
    public GameObject CmdCreatMap(MapType mt) {

        switch (mt)
        {
            case MapType.Grass:
                FloorPrefab = GrassCubePrefab;
                break;
            case MapType.Rock:
                FloorPrefab = RockCubePrefab;
                break;
            case MapType.Ice:
                FloorPrefab = IceCubePrefab;
                break;
            case MapType.Mire:
                FloorPrefab = MireCubePrefab;
                break;
            default:
                break;
        }

        CreateFloor();

        //switch (mt)
        //{
        //    case MapType.Grass:
        //        GrassMap();
        //        break;
        //    case MapType.Rock:
        //        RockMap();
        //        break;
        //    case MapType.Ice:
        //        IceMap();
        //        break;
        //    case MapType.Mire:
        //        MireMap();
        //        break;
        //    default:
        //        break;
        //}
        Debug.LogError("CmdCreatMap()mt:" + mt);

        return FloorParent.gameObject;

    } 
    
    void CreateFloor()
    {
        for (int i = 0; i <= Length; i++)
        {
            for (int j = 0; j <= Width; j++)
            {
                GameObject gFloor = GameObject.Instantiate(FloorPrefab, FloorParent);
                gFloor.transform.position = new Vector3((i- Length/2)*5, 0,(j- Width/2)*5);
                gFloor.name = (i - Length/2)*5 + "_" + (j - Width / 2)*5;
            }
        }
    }

    void GrassMap()
    {
        for (int i = 0; i < SpecialFloor; i++)
        {
            int SpecialLengthPos = Random.Range(-1*Length / 2, Length / 2);
            int SpecialWidthPos = Random.Range(-1*Width/2, Width/2);

            //string strSpecialFloorName = SpecialLengthPos + "_"+ SpecialWidthPos;
            for (int j = 0; j < FloorParent.childCount; j++)
            {
                if (FloorParent.GetChild(j).name== (SpecialLengthPos-1) + "_" + (SpecialWidthPos-1)
                    || FloorParent.GetChild(j).name == (SpecialLengthPos - 1) + "_" + (SpecialWidthPos)
                    || FloorParent.GetChild(j).name == (SpecialLengthPos - 1) + "_" + (SpecialWidthPos + 1)
                    || FloorParent.GetChild(j).name == (SpecialLengthPos) + "_" + (SpecialWidthPos - 1)
                    || FloorParent.GetChild(j).name == (SpecialLengthPos) + "_" + (SpecialWidthPos)
                    || FloorParent.GetChild(j).name == (SpecialLengthPos) + "_" + (SpecialWidthPos + 1)
                    || FloorParent.GetChild(j).name == (SpecialLengthPos + 1) + "_" + (SpecialWidthPos - 1)
                    || FloorParent.GetChild(j).name == (SpecialLengthPos + 1) + "_" + (SpecialWidthPos)
                    || FloorParent.GetChild(j).name == (SpecialLengthPos + 1) + "_" + (SpecialWidthPos + 1)
                    )
                {
                    Destroy(FloorParent.GetChild(j).gameObject);
                }
            }
        }

    }

    void RockMap()
    {
        for (int i = 0; i < SpecialFloor; i++)
        {
            int SpecialLengthPos = Random.Range(-1 * Length / 2, Length / 2);
            int SpecialWidthPos = Random.Range(-1 * Width / 2, Width / 2);

            //string strSpecialFloorName = SpecialLengthPos + "_" + SpecialWidthPos;

            for (int j = 0; j < FloorParent.childCount; j++)
            {
                if (FloorParent.GetChild(j).name == (SpecialLengthPos - 1) + "_" + (SpecialWidthPos - 1)
                    || FloorParent.GetChild(j).name == (SpecialLengthPos - 1) + "_" + (SpecialWidthPos)
                    || FloorParent.GetChild(j).name == (SpecialLengthPos - 1) + "_" + (SpecialWidthPos + 1)
                    || FloorParent.GetChild(j).name == (SpecialLengthPos) + "_" + (SpecialWidthPos - 1)
                    || FloorParent.GetChild(j).name == (SpecialLengthPos) + "_" + (SpecialWidthPos)
                    || FloorParent.GetChild(j).name == (SpecialLengthPos) + "_" + (SpecialWidthPos + 1)
                    || FloorParent.GetChild(j).name == (SpecialLengthPos + 1) + "_" + (SpecialWidthPos - 1)
                    || FloorParent.GetChild(j).name == (SpecialLengthPos + 1) + "_" + (SpecialWidthPos)
                    || FloorParent.GetChild(j).name == (SpecialLengthPos + 1) + "_" + (SpecialWidthPos + 1)
                    )
                {
                    GameObject gSpecialFloor = GameObject.Instantiate(FloorPrefab, FloorParent);
                    gSpecialFloor.transform.position = FloorParent.GetChild(j).position + new Vector3(0f,1f,0f) ;

                }
            }
        }
    }

    void IceMap()
    {

    }

    void MireMap()
    {

    }
}
